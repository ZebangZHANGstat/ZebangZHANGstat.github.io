---
title: "Untitled"
author: "Chenhui Yan"
date: "2024-12-02"
output: html_document
---
```{r}
library(dplyr)
library(plotly)
library(ggplot2)

```

## Education
Is there an association between the percentage of people who graduated high school and the incidence rate 1) across neighborhoods in NYC and 2) across neighborhoods in each borough?

```{r}
data_clean <- read.csv("data_final.csv")
# List all column names
names(data_clean)

# Check the structure of the data frame
str(data_clean)


# Step 1: Check the structure of your dataset to ensure the necessary columns exist
head(data_clean)
```

## Education across neighborhoods in NYC

```{r}
# Calculate the correlation between the graduated in highschool percentage and the incident rate
correlation <- cor(data_clean$incident_rate_by_year_nta, data_clean$Percent_education, use = "complete.obs")
print(paste("Correlation coefficient: ", correlation))

```
The correlation coefficient is -0.2748, indicating a negative relationship between the percentage of people who graduated from high school and the incident rate. This means that there is a tendency for higher education levels to be associated with lower incident rates

```{r}
# Create a scatter plot to visualize the relationship
data_clean %>%
  plot_ly(x = ~Percent_education, y = ~incident_rate_by_year_nta, 
          color = ~NTA, colors = "viridis", 
          type = "scatter", mode = "markers",
          text = ~paste("Neighborhood: ", NTA, "<br>Borough: ", BORO, 
                        "<br>% graduated HS: ", Percent_education, 
                        "<br>Incident Rate: ", incident_rate_by_year_nta)) %>%
  layout(title = "Percent graduated high school and Incident Rate in NYC",
         xaxis = list(title = 'Percentage of People graduated in high school'),
         yaxis = list(title = 'Incident Rate'),
         legend = list(title = list(text = 'Neighborhood')))
```

For neighborhoods with a high percentage of high school graduates (90% and above), incident rates are generally low, often below 0.05. This suggests that higher educational attainment may be associated with fewer incidents

## Education By Borough
```{r}
# Assuming your main data frame is named 'data_clean'

# Filter data for Manhattan
manhattan_data <- data_clean %>%
  filter(neighbourhood_group == "Manhattan")

# Filter data for Brooklyn
brooklyn_data <- data_clean %>%
  filter(neighbourhood_group == "Brooklyn")

# Filter data for The Bronx
bronx_data <- data_clean %>%
  filter(neighbourhood_group == "Bronx")

# Filter data for Staten Island
staten_island_data <- data_clean %>%
  filter(neighbourhood_group == "Staten Island")

# Filter data for Queens
queens_data <- data_clean %>%
  filter(neighbourhood_group == "Queens")

```

```{r}
# Function to compute and print correlation
compute_correlation <- function(data, borough_name) {
  correlation <- cor(
    data$incident_rate_by_year_nta,
    data$Percent_education,
    use = "complete.obs"
  )
  cat("Correlation coefficient for", borough_name, ":", correlation, "\n")
}

compute_correlation(manhattan_data, "Manhattan")
compute_correlation(brooklyn_data, "Brooklyn")
compute_correlation(bronx_data, "Bronx")
compute_correlation(staten_island_data, "Staten Island")
compute_correlation(queens_data, "Queens")

```
* Manhattan: -0.2284
 * There is a weak negative correlation between high school graduation rates and incident rates in Manhattan. This suggests that as the percentage of high school graduates increases, the incident rate tends to decrease slightly. 
 
* Brooklyn: -0.2487
 * Brooklyn also shows a weak negative correlation. The trend is similar to Manhattan, where higher graduation rates are associated with slightly lower incident rates.

* Bronx: -0.3996
 * The Bronx has a moderate negative correlation between graduation rates and incident rates. This suggests a stronger relationship compared to Manhattan and Brooklyn, indicating that in the Bronx, neighborhoods with higher percentages of high school graduates are more likely to have lower incident rates.

* Staten Island: -0.6452
 * Staten Island has a strong negative correlation between high school graduation rates and incident rates.

* Queens: 0.1007
 * Queens shows a weak positive correlation. Unlike the other boroughs, this suggests that in Queens, neighborhoods with higher graduation rates may have slightly higher incident rates, but this relationship is very weak. 
### Manhattan
```{r}
compute_correlation(manhattan_data, "Manhattan")
# Function to create scatter plot with trend line
# Scatter plot for Manhattan
data_clean |> 
  filter(neighbourhood_group == "Manhattan") |> 
  plot_ly(data = _, x = ~Percent_education, y = ~incident_rate_by_year_nta, 
          color = ~NTA,
          colors = "viridis", 
          type = "scatter",
          mode = "markers",
          text = ~paste("Neighborhood: ", NTA, "<br>Borough: ", neighbourhood_group, 
                        "<br>% graduated HS: ", Percent_education, 
                        "<br>Incident Rate: ", incident_rate_by_year_nta)) |> 
    layout(title = "Percent graduated high school and Incident Rate in Manhattan",
           xaxis = list(title = 'Percentage of People graduated in high school'),
           yaxis = list(title = 'Incident Rate'),
           legend = list(title = list(text = 'Neighborhood')))

```

There is no clear linear trend between high school graduation rates and incident rates in Manhattan. The distribution of points suggests a weak negative correlation overall.East Harlem (North and South) and Chinatown-Two Bridges appear to have both lower high school graduation rates and higher incident rates. This suggests that in these neighborhoods, lower educational attainment may be correlated with higher vulnerability.

### Brooklyn
```{r}
# Scatter plot for Brooklyn
data_clean |> 
  filter(neighbourhood_group == "Brooklyn") |> 
  plot_ly(data = _, x = ~Percent_poverty, y = ~incident_rate_by_year_nta, 
          color = ~NTA,
          colors = "plasma", 
          type = "scatter",
          mode = "markers",
          text = ~paste("Neighborhood: ", NTA, "<br>Borough: ", neighbourhood_group, 
                        "<br>% graduated HS: ", Percent_education, 
                        "<br>Incident Rate: ", incident_rate_by_year_nta)) |> 
   layout(title = "Percent graduated high school and Incident Rate in Brooklyn",
           xaxis = list(title = 'Percentage of People graduated in high school'),
           yaxis = list(title = 'Incident Rate'),
           legend = list(title = list(text = 'Neighborhood')))

```

Brownsville and East Flatbush are notable for having both low educational attainment and high incident rates, indicating a relationship between these two variables.

### The Bronx
```{r}
# Scatter plot for The Bronx
data_clean |> 
  filter(neighbourhood_group == "Bronx") |>
  plot_ly(data = _, x = ~Percent_poverty, y = ~incident_rate_by_year_nta, 
          color = ~NTA,
          colors = "magma", 
          type = "scatter",
          mode = "markers",
          text = ~paste("Neighborhood: ", NTA, "<br>Borough: ", neighbourhood_group, 
                        "<br>% graduated HS: ", Percent_education, 
                        "<br>Incident Rate: ", incident_rate_by_year_nta)) |> 
   layout(title = "Percent graduated high school and Incident Rate in The Bronx",
           xaxis = list(title = 'Percentage of People graduated in high school'),
           yaxis = list(title = 'Incident Rate'),
           legend = list(title = list(text = 'Neighborhood')))


```

Co-op City and Morris Park are examples of neighborhoods with higher graduation rates and lower incident rates. This may suggest that neighborhoods with better educational attainment benefit from lower rates of incidents.

### Queens
```{r}
# Scatter plot for Queens
data_clean |> 
  filter(neighbourhood_group == "Queens") |>
  plot_ly(data = _, x = ~Percent_poverty, y = ~incident_rate_by_year_nta, 
          color = ~NTA,
          colors = "inferno", 
          type = "scatter",
          mode = "markers",
          text = ~paste("Neighborhood: ", NTA, "<br>Borough: ", neighbourhood_group, 
                        "<br>% graduated HS: ", Percent_education, 
                        "<br>Incident Rate: ", incident_rate_by_year_nta)) |> 
   layout(title = "Percent graduated high school and Incident Rate in Queens",
           xaxis = list(title = 'Percentage of People graduated in high school'),
           yaxis = list(title = 'Incident Rate'),
           legend = list(title = list(text = 'Neighborhood')))

```

Far Rockaway-Bayswater and Corona tend to have both lower educational attainment and higher incident rates.

### Staten Island
```{r}
# Scatter plot for Staten Island
data_clean |> 
  filter(neighbourhood_group == "Staten Island") |>
  plot_ly(data = _, x = ~Percent_poverty, y = ~incident_rate_by_year_nta, 
          color = ~NTA,
          colors = "inferno", 
          type = "scatter",
          mode = "markers",
          text = ~paste("Neighborhood: ", NTA, "<br>Borough: ", neighbourhood_group, 
                        "<br>% graduated HS: ", Percent_education, 
                        "<br>Incident Rate: ", incident_rate_by_year_nta)) |> 
   layout(title = "Percent graduated high school and Incident Rate in Staten Island",
           xaxis = list(title = 'Percentage of People graduated in Staten Island'),
           yaxis = list(title = 'Incident Rate'),
           legend = list(title = list(text = 'Neighborhood')))

```

Neighborhoods with higher percentages of high school graduates (above 15%) generally have incident rates below 0.02.Port Richmond and St. George-New Brighton are notable for having higher incident rates compared to other neighborhoods with similar graduation rates